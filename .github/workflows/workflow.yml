on:
    push:
    workflow_dispatch:

defaults:
    run:
        shell: bash

jobs:
    job:
        runs-on: macos-15
        steps:
            - name: Install xcodes
              run: |
                curl --remote-name --location https://github.com/XcodesOrg/xcodes/releases/latest/download/xcodes.zip
                unzip xcodes.zip
                echo "xcodes $(./xcodes version) installed"

            - name: Install fastlane
              run: |
                brew install fastlane
                echo "fastlane $(fastlane --version) installed"

            - name: Install Xcode
              run: |
                mkdir -p "$HOME/.fastlane/spaceship/${{ secrets.APPLE_ACCOUNT_EMAIL }}"
                echo "${{ secrets.FASTLANE_COOKIE }}" > "$HOME/.fastlane/spaceship/${{ secrets.APPLE_ACCOUNT_EMAIL }}/cookiesecret_file.txt"
                fastlane spaceauth --user ${{ secrets.APPLE_ACCOUNT_EMAIL }}
                ./xcodes download --use-fastlane-auth --data-source apple 0
              env:
                FASTLANE_SESSION: ${{ secrets.FASTLANE_SESSION }}
