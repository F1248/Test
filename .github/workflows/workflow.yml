on:
    push:
    workflow_dispatch:

defaults:
    run:
        shell: bash

jobs:
    job:
        runs-on: macos-15
        steps:
            - name: Install xcodes
              run: |
                curl --remote-name --location https://github.com/XcodesOrg/xcodes/releases/latest/download/xcodes.zip
                unzip xcodes.zip
                echo "xcodes $(./xcodes version) installed"

            - name: Install fastlane
              run: |
                brew install fastlane
                echo "fastlane $(fastlane --version) installed"

            - name: Install Xcode
              run: |
                mkdir -p ~/.fastlane/spaceship/${{ secrets.APPLE_ACCOUNT_EMAIL }}
                echo -E "$FASTLANE_COOKIE" > ~/.fastlane/spaceship/${{ secrets.APPLE_ACCOUNT_EMAIL }}/cookie
                fastlane spaceauth --user ${{ secrets.APPLE_ACCOUNT_EMAIL }}
                ./xcodes download --use-fastlane-auth --fastlane-user ${{ secrets.APPLE_ACCOUNT_EMAIL }} --data-source apple 0 || true
              env:
                FASTLANE_PASSWORD: ${{ secrets.APPLE_ACCOUNT_PASSWORD }}
                FASTLANE_COOKIE: ${{ secrets.FASTLANE_COOKIE }}
